
<UserControl x:Class="AccountManager.Views.UserControls.GroupPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:AccountManager.Views.Converters"
             x:Name="Root">
    
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <converters:CountToVisibilityConverter x:Key="CountToVisConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource SidebarColor}" 
                Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                          Text="Groups" 
                          FontSize="18" 
                          FontWeight="Medium" 
                          Foreground="{StaticResource SidebarTextPrimaryColor}"
                          VerticalAlignment="Center"/>
                
                <Button Grid.Column="1" 
                       Style="{StaticResource MaterialDesignIconButton}" 
                       Command="{Binding AddGroupCommand, ElementName=Root}"
                       ToolTip="Add Group">
                    <materialDesign:PackIcon Kind="Plus" 
                                           Foreground="{StaticResource SidebarTextPrimaryColor}"/>
                </Button>
            </Grid>
        </Border>
        
        <!-- Groups List -->
        <ListBox Grid.Row="1" 
                ItemsSource="{Binding Groups, ElementName=Root}"
                SelectedItem="{Binding SelectedGroup, ElementName=Root}"
                Background="{StaticResource SidebarColor}"
                BorderThickness="0"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Padding="16,8" 
                           MouseRightButtonUp="OnGroupRightClick">
                        <Border.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Edit" 
                                         Command="{Binding EditGroupCommand, ElementName=Root}"
                                         CommandParameter="{Binding}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Pencil"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Delete" 
                                         Command="{Binding DeleteGroupCommand, ElementName=Root}"
                                         CommandParameter="{Binding}"
                                         Foreground="{StaticResource DangerColor}">
                                    <MenuItem.Icon>
                                        <materialDesign:PackIcon Kind="Delete" Foreground="{StaticResource DangerColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </Border.ContextMenu>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Group Icon -->
                            <materialDesign:PackIcon Grid.Column="0" 
                                                   Kind="Folder" 
                                                   Width="20" 
                                                   Height="20" 
                                                   Foreground="{StaticResource SidebarTextSecondaryColor}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>
                            
                            <!-- Group Info -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Name}" 
                                          FontSize="14" 
                                          FontWeight="Medium" 
                                          Foreground="{StaticResource SidebarTextPrimaryColor}"/>
                                <TextBlock Text="{Binding AccountCount, StringFormat={}{0} accounts}" 
                                          FontSize="12" 
                                          Foreground="{StaticResource SidebarTextSecondaryColor}"
                                          Margin="0,2,0,0"/>
                            </StackPanel>
                            
                            <!-- Account Count Badge -->
                            <Border Grid.Column="2" 
                                   Background="{StaticResource AccentColor}" 
                                   CornerRadius="10" 
                                   Padding="6,2"
                                   Visibility="{Binding AccountCount, Converter={StaticResource CountToVisConverter}}">
                                <TextBlock Text="{Binding AccountCount}" 
                                          FontSize="10" 
                                          FontWeight="Bold" 
                                          Foreground="White"/>
                            </Border>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
            
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Padding" Value="0"/>
                    <EventSetter Event="MouseDoubleClick" Handler="OnGroupDoubleClick"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>
        
        <!-- Empty State -->
        <StackPanel Grid.Row="1" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center"
                   Visibility="{Binding Groups.Count, ElementName=Root, Converter={StaticResource CountToVisConverter}, ConverterParameter=True}">
            <materialDesign:PackIcon Kind="FolderOff" 
                                   Width="48" 
                                   Height="48" 
                                   Foreground="{StaticResource TextSecondaryColor}"
                                   HorizontalAlignment="Center"/>
            <TextBlock Text="No groups yet" 
                      FontSize="16" 
                      Foreground="{StaticResource TextSecondaryColor}"
                      HorizontalAlignment="Center"
                      Margin="0,8,0,4"/>
            <TextBlock Text="Create your first group to get started" 
                      FontSize="12" 
                      Foreground="{StaticResource TextSecondaryColor}"
                      HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
</UserControl>